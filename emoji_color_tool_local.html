<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¨ ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒ â†’ çµµæ–‡å­—è‰²æƒ…å ±JSONç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background: #111; color: #eee; font-family: sans-serif; }
textarea { width: 100%; min-height: 12rem; font-family: monospace; }
</style>
</head>
<body class="p-4">
<h1 class="text-2xl font-bold mb-3">ğŸ¨ ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒ â†’ çµµæ–‡å­—è‰²æƒ…å ±JSONç”Ÿæˆ</h1>

<div class="mb-3">
  <label class="block mb-1">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰</label>
  <input id="imgFiles" type="file" accept="image/*" multiple class="text-white">
</div>

<button id="generate" class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded">å¹³å‡è‰²ã‚’è¨ˆç®—</button>

<p id="status" class="my-3 text-gray-400"></p>
<textarea id="output" readonly></textarea>

<script>
async function getAverageColor(file) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      const data = ctx.getImageData(0, 0, img.width, img.height).data;
      let r = 0, g = 0, b = 0, count = 0;
      for (let i = 0; i < data.length; i += 4) {
        if (data[i + 3] > 100) { // é€æ˜åº¦ãƒ•ã‚£ãƒ«ã‚¿
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
          count++;
        }
      }
      resolve(count ? [r / count, g / count, b / count] : [128,128,128]);
    };
    img.onerror = () => resolve([128,128,128]);
    img.src = URL.createObjectURL(file);
  });
}

document.getElementById("generate").addEventListener("click", async ()=>{
  const files = document.getElementById("imgFiles").files;
  if(!files.length){ alert("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"); return; }

  const result = [];
  let i = 0;
  for(const file of files){
    i++;
    const name = file.name.replace(/\.[^/.]+$/, ""); // æ‹¡å¼µå­é™¤å»
    document.getElementById("status").textContent = `${i}/${files.length} å‡¦ç†ä¸­: ${name}`;
    const color = await getAverageColor(file);
    result.push({ name: `:${name}:`, color: color.map(v=>Math.round(v)) });
  }

  const json = JSON.stringify(result, null, 2);
  document.getElementById("output").value = json;
  document.getElementById("status").textContent = `âœ… å®Œäº†ï¼ ${result.length}ä»¶ç”Ÿæˆã€‚ ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ "emojis.json" ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚`;
});
</script>
</body>
</html>
